/*! calendar-deprecated - v1.0 - 2013-08-20 4:18:57 PM
* Copyright (c) 2013 kissyteam; Licensed  */
KISSY.add("gallery/calendar-deprecated/1.0/base",function(a,b,c,d){function e(a,b){this._init(a,b)}var f=c.Target,g=a.DOM,h=a.UA,i=b.all;return a.augment(e,f,{_init:function(a,c){var d=this,e=i(a);return d.id=d._stamp(e),d._buildParam(c),d.popup?(d.trigger=e,d.con=new b("<div>"),i(document.body).append(d.con),d.con.css({top:"0px",position:"absolute",background:"white",visibility:"hidden","z-index":99999999})):d.con=e,d.C_Id=d._stamp(d.con),d.render(),d._buildEvent(),this},render:function(c){var d,e,f,g=this,i=0;c=c||{},g._parseParam(c),g.con.addClass("ks-cal-call ks-clearfix ks-cal-call-multi-"+g.pages),g.ca=g.ca||[];for(var i=0;i<g.ca.length;i++)g.ca[i].detachEvent();g.__shimEl&&(g.__shimEl.remove(),delete g.__shimEl),g.con.empty(),g.ca.length=g.pages;var j=!1,k=!1;for(g.range&&(g.range.start&&(j=!0),g.range.end&&(k=!0)),f=j&&!g.rangeLinkage?[g.range.start.getFullYear(),g.range.start.getMonth()]:[g.year,g.month],i=0;i<g.pages;i++){0===i?(j&&(g._time=a.clone(g.range.start)),d=!0):g.rangeLinkage?(k&&(g._time=a.clone(g.range.end)),d=!1,f=g._computeNextMonth(f)):(k&&(g._time=a.clone(g.range.end)),d=!0,f=k&&i+1==g.pages?[g.range.end.getFullYear(),g.range.end.getMonth()]:g._computeNextMonth(f)),e=g.rangeLinkage?i==g.pages-1:!0;var l=g.ca[i];g.rangeLinkage||!l||l.year==f[0]&&l.month==f[1]||(f=[l.year,l.month]),g.ca[i]=new g.Page({year:f[0],month:f[1],prevArrow:d,nextArrow:e,showTime:g.showTime},g),g.ca[i].render()}return g.popup&&6===h.ie&&(g.__shimEl=new b("<iframe frameBorder='0' style='position: absolute;border: none;width: expression(this.parentNode.offsetWidth-3);top: 0;left: 0;z-index: 0;height: expression(this.parentNode.offsetHeight-3);'></iframe>"),g.con.prepend(g.__shimEl)),this},destroy:function(){for(var b=this,c=0;c<b.ca.length;c++)b.ca[c].detachEvent();a.each(b.EV,function(a){a&&a.target.detach(a.type,a.fn)}),b.con.remove()},_stamp:function(b){return b.attr("id")||b.attr("id",a.guid("K_Calendar")),b.attr("id")},_buildEvent:function(){var b,c,d=this;if(!d.popup)return this;for(a.each(d.EV,function(a){a&&a.target.detach(a.type,a.fn)}),d.EV=d.EV||[],b=d.EV[0]={target:i(document),type:"click"},b.fn=function(a){var b=i(a.target);if(b.attr("id")!==d.C_Id&&(!b.hasClass("ks-next")&&!b.hasClass("ks-prev")||"A"!==b[0].tagName)&&b.attr("id")!=d.id&&"hidden"!=d.con.css("visibility")&&(!d.con.contains(b)||"option"!==b[0].nodeName.toLowerCase()&&"select"!==b[0].nodeName.toLowerCase())){var c=function(a,b){return a[0]>b[0].x&&a[0]<b[1].x&&a[1]>b[0].y&&a[1]<b[1].y};c([a.pageX,a.pageY],[{x:d.con.offset().left,y:d.con.offset().top},{x:d.con.offset().left+d.con.width(),y:d.con.offset().top+d.con.height()}])||d.hide()}},b.target.on(b.type,b.fn),c=0;c<d.triggerType.length;c++)b=d.EV[c+1]={target:i("#"+d.id),type:d.triggerType[c],fn:function(b){b.target=i(b.target),b.preventDefault();var c=d.triggerType;a.inArray("click",c)&&a.inArray("focus",c)?"focus"==b.type&&d.toggle():a.inArray("click",c)&&!a.inArray("focus",c)?"click"==b.type&&d.toggle():!a.inArray("click",c)&&a.inArray("focus",c)?setTimeout(function(){d.toggle()},170):d.toggle()}},b.target.on(b.type,b.fn);return this},__getAlignOffset:function(a,c){var d,e,f,h,i,j=c.charAt(0),k=c.charAt(1);return a?(a=b.one(a),d=a.offset(),e=a.outerWidth(),f=a.outerHeight()):(d={left:g.scrollLeft(),top:g.scrollTop()},e=g.viewportWidth(),f=g.viewportHeight()),h=d.left,i=d.top,"c"===j?i+=f/2:"b"===j&&(i+=f),"c"===k?h+=e/2:"r"===k&&(h+=e),{left:h,top:i}},toggle:function(){var a=this;"hidden"==a.con.css("visibility")?a.show():a.hide()},show:function(){var a=this;a.con.css("visibility","");var b=a.align.points,c=a.align.offset||[0,0],d=a.con.offset(),e=a.__getAlignOffset(a.trigger,b[0]),f=a.__getAlignOffset(a.con,b[1]),g=[f.left-e.left,f.top-e.top],h=d.left-g[0]+c[0],i=d.top-g[1]+c[1];return a.con.css("left",h.toString()+"px"),a.con.css("top",i.toString()+"px"),a.fire("show"),this},hide:function(){var a=this;return a.con.css("visibility","hidden"),a.fire("hide"),this},_buildParam:function(b){function c(a,c){var f=b[c];e[c]=f===d||null===f?a:f}var e=this;return(b===d||null===b)&&(b={}),a.each({date:new Date,selected:null,startDay:0,pages:1,closable:!1,rangeSelect:!1,minDate:!1,maxDate:!1,multiSelect:!1,multi:null,navigator:!0,popup:!1,showTime:!1,triggerType:["click"],disabled:null,range:null,rangeLinkage:!0,align:{points:["bl","tl"],offset:[0,0]},notLimited:!1},c),this},_parseParam:function(a){var b,c=this;(a===d||null===a)&&(a={});for(b in a)c[b]=a[b];if("string"==typeof c.triggerType&&(c.triggerType=[c.triggerType]),c.startDay=c.startDay%7,c.startDay<0&&(c.startDay+=7),c.EV=[],c._handleDate(),c.multiSelect&&(c.rangeSelect=!1,c.range=null,c.selected=null,c.multi))for(var b=0;b<c.multi.length;b++)c.multi[b]instanceof Date&&(c.multi[b]=c._handleDate2String(c.multi[b]));return this},_templetShow:function(a,b){var c,e,f,g,h,i;if(b instanceof Array){for(c="",f=0;f<b.length;f++)c+=arguments.callee(a,b[f]);a=c}else if(e=a.match(/{\$(.*?)}/g),b!==d&&null!==e)for(f=0,g=e.length;g>f;f++)i=e[f].replace(/({\$)|}/g,""),h=b[i]!==d?b[i]:"",a=a.replace(e[f],h);return a},_handleDate:function(){var a=this,b=a.date;return a.weekday=b.getDay()+1,a.day=b.getDate(),a.month=b.getMonth(),a.year=b.getFullYear(),this},_handleDate2String:function(a){var b=a.getFullYear(),c=a.getMonth(),d=a.getDate();return b+"-"+(c>8?c+1:"0"+(c+1))+"-"+(d>9?d:"0"+d)},_handleString2Date:function(a){var b=a.toString().split("-");if(3==b.length){var c=new Date(parseInt(b[0],10),parseInt(b[1],10)-1,parseInt(b[2],10));if(c instanceof Date&&"Invalid Date"!=c&&!isNaN(c))return c}},_getHeadStr:function(a,b){return a.toString()+"\u5e74"+(Number(b)+1).toString()+"\u6708"},_monthAdd:function(){var a=this;return 11==a.month?(a.year++,a.month=0):a.month++,a.date=new Date(a.year.toString()+"/"+(a.month+1).toString()+"/1"),this},_monthMinus:function(){var a=this;return 0===a.month?(a.year--,a.month=11):a.month--,a.date=new Date(a.year.toString()+"/"+(a.month+1).toString()+"/1"),this},_yearAdd:function(){var a=this;return a.year++,a.date=new Date(a.year.toString()+"/"+(a.month+1).toString()+"/1"),this},_yearMinus:function(){var a=this;return a.year--,a.date=new Date(a.year.toString()+"/"+(a.month+1).toString()+"/1"),this},_computeNextMonth:function(a){var b=a[0],c=a[1];return 11==c?(b++,c=0):c++,[b,c]},_handleOffset:function(){for(var a=this,b=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],c="<span>{$day}</span>",d=a.startDay,e="",f=[],g=0;7>g;g++)f[g]={day:b[(g+d)%7]};return e=a._templetShow(c,f),{day_html:e}},_handleRange:function(a){var b,c=this;return c.range=c.range||{start:null,end:null},null===c.range.start&&null===c.range.end||null!==c.range.start&&null!==c.range.end?(c.range.start=a,c.range.end=null):null!==c.range.start&&null===c.range.end&&(c.range.end=a,c.range.start.getTime()>c.range.end.getTime()&&(b=c.range.start,c.range.start=c.range.end,c.range.end=b),c.fire("rangeSelect",c.range),c.popup&&c.closable&&c.hide()),this},_handleMultiSelectStart:function(a){var b=this;b.multiStart=a},_handleMultiSelectEnd:function(b){var c=this;if(c.multiStart){for(c.multi=c.multi||[],b<c.multiStart?(c.multiEnd=c.multiStart,c.multiStart=b):c.multiEnd=b,c.minDate&&c.multiStart<c.minDate&&(c.multiStart=new Date(c.minDate.getFullYear(),c.minDate.getMonth(),c.minDate.getDate())),c.maxDate&&c.multiEnd>c.maxDate&&(c.multiEnd=new Date(c.maxDate.getFullYear(),c.maxDate.getMonth(),c.maxDate.getDate()));c.multiStart<=c.multiEnd;){var d=!1;if(c.disabled&&c.disabled.length>0)for(var e=0;e<c.disabled.length;e++){var f=c.disabled[e];if(f.getTime()==c.multiStart.getTime()){d=!0;break}}if(!d){var g=c._handleDate2String(c.multiStart);a.inArray(g,c.multi)?c.multi.splice(a.indexOf(g,c.multi),1):c.multi.push(g),c.multiStart.setDate(c.multiStart.getDate()+1)}}c.multiStart=null,c.render()}},_handleMultiSelect:function(){var a=this;a.multi=a.multi||[],a.multi.sort(function(a,b){return a>b?1:-1});for(var b=0;b<a.multi.length;b++)a.multi[b]=a._handleString2Date(a.multi[b]);a.fire("multiSelect",{multi:a.multi}),a.popup&&a.closable&&a.hide()}}),e},{requires:["node","event"]}),KISSY.add("gallery/calendar-deprecated/1.0/page",function(a,b,c){return a.augment(c,{Page:function(c,d){this.father=d,this.month=Number(c.month),this.year=Number(c.year),this.prevArrow=c.prevArrow,this.nextArrow=c.nextArrow,this.node=null,this.timmer=null,this.id="",this.html=['<div class="ks-cal-box" id="{$id}">','<div class="ks-cal-hd">','<a href="javascript:void(0);" class="ks-prev-year {$prev}"><</a><a href="javascript:void(0);" class="ks-prev-month {$prev}"><</a>','<a href="javascript:void(0);" class="ks-title">{$title}</a>','<a href="javascript:void(0);" class="ks-next-month {$next}">></a><a href="javascript:void(0);" class="ks-next-year {$next}">></a>',"</div>",'<div class="ks-cal-bd">','<div class="ks-whd">',d._handleOffset().day_html,"</div>",'<div class="ks-dbd ks-clearfix">',"{$ds}",'<div style="clear:both;"></div>',"</div>","</div>",'<div class="ks-setime hidden">',"</div>",'<div class="{$notlimited}"><a href="#" class="ks-cal-notLimited {$notlimitedCls}">\u4e0d\u9650</a></div>','<div class="ks-multi-select {$multiSelect}"><button class="ks-multi-select-btn">\u786e\u5b9a</button></div>','<div class="ks-cal-ft {$showtime}">','<div class="ks-cal-time">',"\u65f6\u95f4\uff1a00:00 &hearts;","</div>","</div>",'<div class="ks-selectime hidden">',"</div>","</div><!--#ks-cal-box-->"].join(""),this.nav_html=["<p>","\u6708",'<select value="{$the_month}">','<option class="m1" value="1">01</option>','<option class="m2" value="2">02</option>','<option class="m3" value="3">03</option>','<option class="m4" value="4">04</option>','<option class="m5" value="5">05</option>','<option class="m6" value="6">06</option>','<option class="m7" value="7">07</option>','<option class="m8" value="8">08</option>','<option class="m9" value="9">09</option>','<option class="m10" value="10">10</option>','<option class="m11" value="11">11</option>','<option class="m12" value="12">12</option>',"</select>","</p>","<p>","\u5e74",'<input type="text" value="{$the_year}" onfocus="this.select()"/>',"</p>","<p>",'<button class="ok">\u786e\u5b9a</button><button class="cancel">\u53d6\u6d88</button>',"</p>"].join(""),this.Verify=function(){var a=function(a){return/^\d+$/i.test(a)?(a=Number(a),!(1>a||a>31)):!1},b=function(a){return/^\d+$/i.test(a)?(a=Number(a),!(100>a||a>1e4)):!1},c=function(a){return/^\d+$/i.test(a)?(a=Number(a),!(1>a||a>12)):!1};return{isDay:a,isYear:b,isMonth:c}},this._renderUI=function(){var a,c=this,d={};return c.HTML="",d.prev="",d.next="",d.title="",d.ds="",d.notlimited="",d.notlimitedClass="",c.prevArrow||(d.prev="hidden"),c.nextArrow||(d.next="hidden"),c.father.showTime||(d.showtime="hidden"),c.father.notLimited||(d.notlimited="hidden"),c.father.multiSelect||(d.multiSelect="hidden"),c.father.showTime&&c.father.notLimited&&(d.notlimitedCls="ks-cal-notLimited-showTime"),c.father.notLimited&&!c.father.selected&&(d.notlimitedCls+=" ks-cal-notLimited-selected"),d.id=c.id="ks-cal-"+Math.random().toString().replace(/.\./i,""),d.title=c.father._getHeadStr(c.year,c.month),c.createDS(),d.ds=c.ds,c.father.con.append(c.father._templetShow(c.html,d)),c.node=b.one("#"+c.id),c.father.showTime&&(a=c.node.one(".ks-cal-ft"),c.timmer=new c.father.TimeSelector(a,c.father)),this},this.detachEvent=function(){var b=this;b.EV=b.EV||[],a.each(b.EV,function(a){a&&a.target.detach(a.type,a.fn)})},this._buildEvent=function(){function a(){c.target.on(c.type,c.fn)}var c,d=this,e=b.one("#"+d.id);return d.EV=[],d.father.multiSelect||(c=d.EV[d.EV.length]={target:e.one("div.ks-dbd"),type:"click",fn:function(a){if(a.preventDefault(),"A"==a.target.tagName&&(a.target=b(a.target),!a.target.hasClass("ks-null")&&!a.target.hasClass("ks-disabled"))){var c=new Date(d.year,d.month,Number(a.target.html()));d.father.dt_date=c,d.father.fire("select",{date:c}),d.father.popup&&d.father.closable&&!d.father.showTime&&!d.father.rangeSelect&&d.father.hide(),d.father.rangeSelect&&(d.timmer&&(c.setHours(d.timmer.get("h")),c.setMinutes(d.timmer.get("m")),c.setSeconds(d.timmer.get("s"))),d.father._handleRange(c)),d.father.render({selected:c})}}},a()),c=d.EV[d.EV.length]={target:e.one("a.ks-prev-month"),type:"click",fn:function(a){a.preventDefault(),d.father.rangeLinkage||d._monthMinus(),d.father._monthMinus().render(),d.father.fire("monthChange",{date:new Date(d.father.year+"/"+(d.father.month+1)+"/01")})}},a(),c=d.EV[d.EV.length]={target:e.one("a.ks-next-month"),type:"click",fn:function(a){a.preventDefault(),d.father.rangeLinkage||d._monthAdd(),d.father._monthAdd().render(),d.father.fire("monthChange",{date:new Date(d.father.year+"/"+(d.father.month+1)+"/01")})}},a(),c=d.EV[d.EV.length]={target:e.one("a.ks-prev-year"),type:"click",fn:function(a){a.preventDefault(),d.father.rangeLinkage||d._yearMinus(),d.father._yearMinus().render(),d.father.fire("monthChange",{date:new Date(d.father.year+"/"+(d.father.month+1)+"/01")})}},a(),c=d.EV[d.EV.length]={target:e.one("a.ks-next-year"),type:"click",fn:function(a){a.preventDefault(),d.father.rangeLinkage||d._yearAdd(),d.father._yearAdd().render(),d.father.fire("monthChange",{date:new Date(d.father.year+"/"+(d.father.month+1)+"/01")})}},a(),d.father.navigator&&(c=d.EV[d.EV.length]={target:e.one("a.ks-title"),type:"click",fn:function(a){try{d.timmer.hidePopup(),a.preventDefault()}catch(c){}a.target=b(a.target);var f=e.one(".ks-setime");f.html("");var g=d.father._templetShow(d.nav_html,{the_month:d.month+1,the_year:d.year});f.html(g),f.removeClass("hidden"),e.one("input").on("keydown",function(a){if(a.target=b(a.target),38==a.keyCode&&(a.target.val(Number(a.target.val())+1),a.target[0].select()),40==a.keyCode&&(a.target.val(Number(a.target.val())-1),a.target[0].select()),13==a.keyCode){var c=e.one(".ks-setime").one("select").val(),f=e.one(".ks-setime").one("input").val();if(e.one(".ks-setime").addClass("hidden"),!d.Verify().isYear(f))return;if(!d.Verify().isMonth(c))return;d.father.render({date:new Date(f+"/"+c+"/01")}),d.father.fire("monthChange",{date:new Date(f+"/"+c+"/01")})}})}},a(),c=d.EV[d.EV.length]={target:e.one(".ks-setime"),type:"click",fn:function(a){if(a.preventDefault(),a.target=b(a.target),a.target.hasClass("ok")){var c=e.one(".ks-setime").one("select").val(),f=e.one(".ks-setime").one("input").val();if(e.one(".ks-setime").addClass("hidden"),!d.Verify().isYear(f))return;if(!d.Verify().isMonth(c))return;d.father.render({date:new Date(f+"/"+c+"/01")}),d.father.fire("monthChange",{date:new Date(f+"/"+c+"/01")})}else a.target.hasClass("cancel")&&e.one(".ks-setime").addClass("hidden")}},a()),d.father.notLimited&&(c=d.EV[d.EV.length]={target:e.one(".ks-cal-notLimited"),type:"click",fn:function(a){a.preventDefault(),d.father.range={start:null,end:null},d.father.fire("select",{date:null}),d.father.popup&&d.father.closable&&d.father.hide(),d.father.render({selected:null})}},a()),d.father.multiSelect&&(c=d.EV[d.EV.length]={target:e.one("div.ks-dbd"),type:"mousedown",fn:function(a){if(a.preventDefault(),"A"==a.target.tagName&&(a.target=b(a.target),!a.target.hasClass("ks-null")&&!a.target.hasClass("ks-disabled"))){var c=new Date(d.year,d.month,Number(a.target.html()));d.father._handleMultiSelectStart(c)}}},a(),c=d.EV[d.EV.length]={target:e.one("div.ks-dbd"),type:"mouseup",fn:function(a){if(a.preventDefault(),"A"==a.target.tagName&&(a.target=b(a.target),!a.target.hasClass("ks-null")&&!a.target.hasClass("ks-disabled"))){var c=new Date(d.year,d.month,Number(a.target.html()));d.father._handleMultiSelectEnd(c)}}},a(),c=d.EV[d.EV.length]={target:e.one(".ks-multi-select-btn"),type:"click",fn:function(a){a.preventDefault(),d.father._handleMultiSelect()}},a()),this},this._monthAdd=function(){var a=this;11==a.month?(a.year++,a.month=0):a.month++},this._monthMinus=function(){var a=this;0===a.month?(a.year--,a.month=11):a.month--},this._yearAdd=function(){var a=this;a.year++},this._yearMinus=function(){var a=this;a.year--},this._getNode=function(){var a=this;return a.node},this._getNumOfDays=function(a,b){return 32-new Date(a,b-1,32).getDate()},this._isDisabled=function(a,b){if(a&&a.length>0)for(var c=0;c<a.length;c++){var d=a[c];if(b.getFullYear()==d.getFullYear()&&b.getMonth()==d.getMonth()&&b.getDate()==d.getDate())return!0}return!1},this.isInMulit=function(a,b){if(a&&a.length>0)for(var c=0;c<a.length;c++){var d=a[c].split("-");if(b.getFullYear()==parseInt(d[0],10)&&b.getMonth()==parseInt(d[1],10)-1&&b.getDate()==parseInt(d[2],10))return!0}return!1},this.createDS=function(){for(var a,b=this,c="",d=(7-b.father.startDay+new Date(b.year+"/"+(b.month+1)+"/01").getDay())%7,e=b._getNumOfDays(b.year,b.month+1),f=b.father.selected,g=new Date,a=0;d>a;a++)c+='<a href="javascript:void(0);" class="ks-null">0</a>';for(a=1;e>=a;a++){var h="",i=new Date(b.year,b.month,a);b.father.minDate&&new Date(b.year,b.month,a+1)<=b.father.minDate||b.father.maxDate&&i>b.father.maxDate||b._isDisabled(b.father.disabled,i)?h="ks-disabled":b.father.range&&i>=b.father.range.start&&i<=b.father.range.end?h="ks-range":(f&&f.getFullYear()==b.year&&f.getMonth()==b.month&&f.getDate()==a||b.isInMulit(b.father.multi,i))&&(h="ks-selected"),g.getFullYear()==b.year&&g.getMonth()==b.month&&g.getDate()==a&&(h+=" ks-today"),c+="<a "+(h?'class="'+h+'"':"")+' href="javascript:void(0);">'+a+"</a>"}return b.ds=c,this},this.render=function(){var a=this;return a._renderUI(),a._buildEvent(),this}}}),c},{requires:["node","./base"]}),KISSY.add("gallery/calendar-deprecated/1.0/time",function(a,b,c){return a.augment(c,{TimeSelector:function(a,c){this.father=c,this.fcon=a.parent(".ks-cal-box"),this.popupannel=this.fcon.one(".ks-selectime"),"undefined"==typeof c._time&&(c._time=new Date),this.time=c._time,this.status="s",this.ctime=b('<div class="ks-cal-time">\u65f6\u95f4\uff1a<span class="h">h</span>:<span class="m">m</span>:<span class="s">s</span><!--{{arrow--><div class="cta"><button class="u"></button><button class="d"></button></div><!--arrow}}--></div>'),this.button=b('<button class="ct-ok">\u786e\u5b9a</button>'),this.h_a=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23"],this.m_a=["00","10","20","30","40","50"],this.s_a=["00","10","20","30","40","50"],this.parseSubHtml=function(a){for(var b="",c=0;c<a.length;c++)b+='<a href="javascript:void(0);" class="item">'+a[c]+"</a>";return b+='<a href="javascript:void(0);" class="x">x</a>'},this.showPopup=function(a){var b=this;this.popupannel.html(a),this.popupannel.removeClass("hidden");var c=b.status;switch(b.ctime.all("span").removeClass("on"),c){case"h":b.ctime.all(".h").addClass("on");break;case"m":b.ctime.all(".m").addClass("on");break;case"s":b.ctime.all(".s").addClass("on")}},this.hidePopup=function(){this.popupannel.addClass("hidden")},this.render=function(){var a=this,b=a.get("h"),c=a.get("m"),d=a.get("s");return a.father._time=a.time,a.ctime.all(".h").html(b),a.ctime.all(".m").html(c),a.ctime.all(".s").html(d),a},this.set=function(a,b){var c=this;switch(b=Number(b),a){case"h":c.time.setHours(b);break;case"m":c.time.setMinutes(b);break;case"s":c.time.setSeconds(b)}c.render()},this.get=function(a){var b=this,c=b.time;switch(a){case"h":return c.getHours();case"m":return c.getMinutes();case"s":return c.getSeconds()}},this.add=function(){var a=this,b=a.status,c=a.get(b);c++,a.set(b,c)},this.minus=function(){var a=this,b=a.status,c=a.get(b);c--,a.set(b,c)},this._init=function(){var c=this;a.html("").append(c.ctime),a.append(c.button),c.render(),c.popupannel.on("click",function(a){var d=b(a.target);if(d.hasClass("x"))c.hidePopup();else if(d.hasClass("item")){var e=Number(d.html());c.set(c.status,e),c.hidePopup()}}),c.button.on("click",function(){var a="undefined"==typeof c.father.dt_date?c.father.date:c.father.dt_date;a.setHours(c.get("h")),a.setMinutes(c.get("m")),a.setSeconds(c.get("s")),c.father.fire("timeSelect",{date:a}),c.father.popup&&c.father.closable&&c.father.hide()}),c.ctime.on("keyup",function(a){(38==a.keyCode||37==a.keyCode)&&(a.preventDefault(),c.add()),(40==a.keyCode||39==a.keyCode)&&(a.preventDefault(),c.minus())}),c.ctime.one(".u").on("click",function(){c.hidePopup(),c.add()}),c.ctime.one(".d").on("click",function(){c.hidePopup(),c.minus()}),c.ctime.one(".h").on("click",function(){var a=c.parseSubHtml(c.h_a);c.status="h",c.showPopup(a)}),c.ctime.one(".m").on("click",function(){var a=c.parseSubHtml(c.m_a);c.status="m",c.showPopup(a)}),c.ctime.one(".s").on("click",function(){var a=c.parseSubHtml(c.s_a);c.status="s",c.showPopup(a)})},this._init()}}),c},{requires:["node","./base"]}),KISSY.add("gallery/calendar-deprecated/1.0/date",function(){function a(a,b){var c=null;if(b=b||"-",c instanceof Date)return c;if(c=new Date(a),c instanceof Date&&"Invalid Date"!=c&&!isNaN(c))return c;var d=a.toString().split(b);return 3==d.length&&(c=new Date(d[0],parseInt(d[1],10)-1,d[2]),c instanceof Date&&"Invalid Date"!=c&&!isNaN(c))?c:null}var b=function(){var a=/w{1}|d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,b=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,c=/[^-+\dA-Z]/g,d=function(a,b){for(a=String(a),b=b||2;a.length<b;)a="0"+a;return a},e={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUTCDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",localShortDate:"yy\u5e74mm\u6708dd\u65e5",localShortDateTime:"yy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localLongDate:"yyyy\u5e74mm\u6708dd\u65e5",localLongDateTime:"yyyy\u5e74mm\u6708dd\u65e5 hh:MM:ss TT",localFullDate:"yyyy\u5e74mm\u6708dd\u65e5 w",localFullDateTime:"yyyy\u5e74mm\u6708dd\u65e5 w hh:MM:ss TT"},f={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","\u661f\u671f\u65e5","\u661f\u671f\u4e00","\u661f\u671f\u4e8c","\u661f\u671f\u4e09","\u661f\u671f\u56db","\u661f\u671f\u4e94","\u661f\u671f\u516d"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};return function(g,h,i){if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(g)||/\d/.test(g)||(h=g,g=void 0),g=g?new Date(g):new Date,isNaN(g))throw SyntaxError("invalid date");h=String(e[h]||h||e["default"]),"UTC:"==h.slice(0,4)&&(h=h.slice(4),i=!0);var j=i?"getUTC":"get",k=g[j+"Date"](),l=g[j+"Day"](),m=g[j+"Month"](),n=g[j+"FullYear"](),o=g[j+"Hours"](),p=g[j+"Minutes"](),q=g[j+"Seconds"](),r=g[j+"Milliseconds"](),s=i?0:g.getTimezoneOffset(),t={d:k,dd:d(k,void 0),ddd:f.dayNames[l],dddd:f.dayNames[l+7],w:f.dayNames[l+14],m:m+1,mm:d(m+1,void 0),mmm:f.monthNames[m],mmmm:f.monthNames[m+12],yy:String(n).slice(2),yyyy:n,h:o%12||12,hh:d(o%12||12,void 0),H:o,HH:d(o,void 0),M:p,MM:d(p,void 0),s:q,ss:d(q,void 0),l:d(r,3),L:d(r>99?Math.round(r/10):r,void 0),t:12>o?"a":"p",tt:12>o?"am":"pm",T:12>o?"A":"P",TT:12>o?"AM":"PM",Z:i?"UTC":(String(g).match(b)||[""]).pop().replace(c,""),o:(s>0?"-":"+")+d(100*Math.floor(Math.abs(s)/60)+Math.abs(s)%60,4),S:["th","st","nd","rd"][k%10>3?0:(10!=k%100-k%10)*k%10]};return h.replace(a,function(a){return a in t?t[a]:a.slice(1,a.length-1)})}}();return{format:function(a,c,d){return b(a,c,d)},parse:function(b,c){return a(b,c)}}}),KISSY.add("gallery/calendar-deprecated/1.0/index",function(a,b,c,d,e){return b.Date=e,a.Calendar=b,b},{requires:["./base","./page","./time","./date"]});